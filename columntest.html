<html>
    
    <head>
        <link rel="stylesheet" href="assets/css/odometer-theme-plaza.css"/>
        <link rel="stylesheet" href="columntest.css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="assets/js/odometer.min.js"></script>
        <script src="https://use.fontawesome.com/53dde11fa6.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    </head>

<body>



<div class="row" style="height:50%">
    
    
  <div class="col-xs-12 col-sm-4" style="color: black; background-color: #1975bc">
            <h1 align='center'><i class="fa fa-user" aria-hidden="true"></i> Patrons</h1> 
            <div class="row">
                <div class="col-lg-8">
                    <p>Blocked patrons: </p>
                    <p>Average Age: </p>
                    <p>Chapel Hill: </p>
                    <p>Other: </p>
                </div>
            </div>
  </div>
  
  <div class="col-xs-6 col-sm-4" style="color: black; background-color: #61c491">
            <h1 align='center'><i class="fa fa-id-card" aria-hidden="true"></i> Library Cards</h1> 
            <div class="row">
                <div class="col-lg-8">
                    <p>Total: <span id=p0 class="odometer">0</span></p>
                    <p>Percent Expired: <span id=p1 class="odometer">0</span>%</p>
                </div>
            </div>
  </div>
  
  <div class="col-xs-6 col-sm-4" style="color: black; background-color: #f44641">
            <h1 align="center"><i class="fa fa-users" aria-hidden="true"></i> Meetings</h1>
            <div class="row">
                <div class="col-lg-8">
                    <p> Today: <span id=m0 class="odometer">0</span></p>
                    <p> This week: <span id=m1 class="odometer">0</span></p>
                    <p> This month: <span id=m2 class="odometer">0</span></p>
                    <p> This year: <span id=m3 class="odometer">0</span></p>
                </div>
            </div>
  </div>

</div>


<div class="row" style="height:50%">
  <div class="col-xs-6 col-sm-4" style="color: black; background-color: #00bff3">
            <h1 align='center'><i class="fa fa-barcode" aria-hidden="true"></i> Items</h1> 
            <div class="row">
                <div class="col-lg-8">
                    <p>Checkouts today: </p>
                    <p>Returns today:</p>
                    <p>Amount overdue: </p>
                </div>
            </div>
  </div>

  
  <div class="col-xs-6 col-sm-4" style="color: black; background-color: #555555">
            <h1 align='center'><i class="fa fa-line-chart" aria-hidden="true"></i> Open Data</h1> 
            <div class="row">
                <div class="col-lg-8">
                    <p>Number of datasets: </p>
                </div>
            </div>
  </div>
 
 
 
  <div class="col-xs-6 col-sm-4" style="color: black; background-color: #1975bc">
            <h1 align='center'><i class="fa fa-truck" aria-hidden="true"></i></i> Circulator</h1> 
            <div class="row">
                <div class="col-lg-8">
                    <p>Current Location: </p>
                    <p># of Items:</p>
                </div>
            </div>
  </div>
</div>

<script type="text/javascript" src="secrets.js"></script>
<script type="text/javascript">
        /*global $*/
        // initialize variables for interval of refreshing
        var minutes = 120;
        var milliseconds = min_to_ms(minutes);
        
        // function that converts minutes to milliseconds for use in update_interval function
        function min_to_ms(min){
            return min*60*1000;
        }
        
        // function that gets a json and updates the page 
        function update_page() {
            // gets local json file
            /*global $*/
            /*global ODS_api*/
            $.getJSON("https://www.chapelhillopendata.org/api/records/1.0/search/?dataset=meeting-room-usage&rows=1000&sort=time&apikey=" + ODS_api + "&callback=?", function(meeting){
                var lengthOfMeeting = meeting.records.length;
                // initialize a variable to display the title (today's date) at the top and list of usage data
                var title = true;
                var usage_values = [];
                
                // loops through file and adds a row of data to the table after each iteration
                for (var i = 0; i < meeting.records.length; i++) {
                    var record = meeting.records[i];
                    var time = record.fields.time.split(' ');
                    // skip table data
                    if(record.fields.status == "Approved" || record.fields.status == "Pending"){
                        continue;
                    // monthly popularity data
                    }else if(record.fields.enddate == '%'){
                        continue;
                    // usage data
                    }else{
                        usage_values.push(Number(record.fields.time));
                    }
                }
                
                //loops through id's 0 - 3 and adds usage values
                for (var i = 0; i < usage_values.length; i++) {
                    $('#m' + i).text(usage_values[i]);
                }
                
            });
            
            $.getJSON("https://www.chapelhillopendata.org/api/records/1.0/search/?dataset=patron-dashboard&rows=1&apikey=" + ODS_api + "&callback=?", function(exp_patron){
                var amount_exp = exp_patron.nhits
                $.getJSON("https://www.chapelhillopendata.org/api/records/1.0/search/?dataset=patrons&rows=1&apikey=" + ODS_api + "&callback=?", function(all_patrons){
                    var amount_total = all_patrons.nhits;
                    $('#p0').text(amount_exp.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                    $('#p1').text((amount_exp/amount_total * 100).toFixed(2));
                });
            });
            
        }
        
        // function that calls update_page every specified minutes
        function update_interval(interval) {
            var update = setInterval(update_page, interval);
        }
        
        // call update_page to get the initial values
        update_page();
        
        // call update_interval to display the data and start timer
        update_interval(milliseconds);
        
    </script>
</body>
</html>